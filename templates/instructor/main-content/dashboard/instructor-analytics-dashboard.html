<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Analytics Dashboard - Apprentice Tutors</title>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js for Graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body { background-color: #f3f4f6; font-family: 'Inter', sans-serif; }
        .sidebar-expanded { width: 280px; }
        .main-content { margin-left: 280px; transition: margin-left 0.3s; }
        .tab-button { transition: all 0.2s; }
        .tab-button.active { border-bottom-color: #4f46e5; color: #4f46e5; font-weight: 600; }
        .progress-bar-bg { background-color: #e5e7eb; }
        .progress-bar { background-color: #4f46e5; transition: width 0.5s ease-in-out; }
    </style>
</head>
<body class="bg-gray-100">
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <aside class="fixed top-0 left-0 z-40 h-screen bg-gray-900 text-gray-100 shadow-xl flex flex-col sidebar-expanded">
            <div class="flex items-center justify-between p-5 border-b border-gray-800">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-lg bg-indigo-600 flex items-center justify-center text-white text-2xl font-bold">A</div>
                    <div class="font-bold text-xl whitespace-nowrap">Apprentice Tutors</div>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto py-5 px-3">
                <h3 class="uppercase text-xs tracking-wider text-gray-400 px-4 mb-2">Main</h3>
                <a href="#" class="flex items-center p-3 rounded-lg mb-2 cursor-pointer transition-all hover:bg-gray-800">
                    <i class="fas fa-home fa-fw mr-4"></i>
                    <span class="whitespace-nowrap">Dashboard</span>
                </a>
                <a href="#" class="flex items-center p-3 rounded-lg mb-2 cursor-pointer transition-all bg-indigo-600 text-white">
                    <i class="fas fa-chart-bar fa-fw mr-4"></i>
                    <span class="whitespace-nowrap">Analytics</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content w-full p-8">
            <!-- Header and Tabs -->
            <div class="flex flex-wrap justify-between items-center gap-4 mb-6 border-b border-gray-200 pb-4">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">Analytics Dashboard</h1>
                    <p class="mt-1 text-gray-600">Insights into learner and content performance.</p>
                </div>
                <!-- Tab Navigation -->
                <div class="flex border-b-2 border-transparent">
                    <button id="tab-overview-btn" onclick="showTab('overview')" class="tab-button active py-2 px-4">Dashboard Overview</button>
                    <button id="tab-drilldown-btn" onclick="showTab('drilldown')" class="tab-button py-2 px-4">Student Drilldown</button>
                </div>
            </div>

            <!-- TAB 1: Dashboard Overview -->
            <div id="dashboard-overview" class="space-y-8">
                <!-- KPI Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-md"><p class="text-sm font-medium text-gray-500">Active Learners</p><p id="og-kpi-active-learners" class="text-3xl font-bold text-gray-800"></p></div>
                    <div class="bg-white p-6 rounded-lg shadow-md"><p class="text-sm font-medium text-gray-500">Avg. Session Duration</p><p id="og-kpi-avg-session" class="text-3xl font-bold text-gray-800"></p></div>
                    <div class="bg-white p-6 rounded-lg shadow-md"><p class="text-sm font-medium text-gray-500">Most Active Course</p><p id="og-kpi-most-course" class="text-lg font-bold text-indigo-600 truncate"></p></div>
                    <div class="bg-white p-6 rounded-lg shadow-md"><p class="text-sm font-medium text-gray-500">Most Used Tutor</p><p id="og-kpi-most-tutor" class="text-lg font-bold text-indigo-600 truncate"></p></div>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-indigo-500">
                    <h2 class="text-xl font-bold text-gray-800 mb-2">Key Insights (Last 30 Days)</h2>
                    <div id="dynamic-insights" class="text-gray-700 space-y-2"></div>
                </div>

                <div class="mt-8 pt-6 border-t border-gray-200">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Learner Progress & Engagement</h2>
                </div>

                <!-- Daily Active Learners & Top Learners -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div><h3 class="font-semibold text-gray-700 mb-2">Daily Active Learners</h3><div class="h-64"><canvas id="learnerActivityChart"></canvas></div></div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div><h3 class="font-semibold text-gray-700 mb-2">Top Learners (by Modules Completed)</h3><div class="h-64"><canvas id="topLearnersChart"></canvas></div></div>
                    </div>
                </div>
                <!-- Learner Drilldown -->
                <div class="bg-white p-6 rounded-lg shadow-md"><h2 class="text-xl font-bold text-gray-800 mb-4">Learner
                    Progress</h2>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                            <tr class="bg-gray-50 text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                <th class="p-3">Student Name</th>
                                <th class="p-3">Progress</th>
                                <th class="p-3">Average Score</th>
                                <th class="p-3">Time Spent</th>
                                <th class="p-3 text-center">Actions</th>
                            </tr>
                            </thead>
                            <tbody id="learner-table-body" class="text-sm divide-y divide-gray-200"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- TAB 2: Student Drilldown -->
            <div id="student-drilldown" class="hidden">
                 <div id="drilldown-placeholder" class="text-center py-20 bg-white rounded-lg shadow-md">
                    <i class="fas fa-user-graduate text-5xl text-gray-400 mb-4"></i>
                    <h2 class="text-2xl font-bold text-gray-700">Select a Student</h2>
                    <p class="text-gray-500">Click the "View Details" button on a student from the dashboard to see their progress.</p>
                     <button onclick="showTab('overview')" class="mt-6 bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700">&larr; Back to Dashboard</button>
                </div>
                
                <div id="drilldown-content" class="hidden space-y-8">
                    <div class="flex justify-between items-start">
                        <div><h2 class="text-3xl font-bold text-gray-800">Analytics for <span id="student-name-header" class="text-indigo-600"></span></h2><p class="text-gray-600">A detailed look at their learning journey.</p></div>
                        <button onclick="showTab('overview')" class="bg-white border border-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-50">&larr; Back to Dashboard</button>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                         <div class="bg-white p-6 rounded-lg shadow-md"><p class="text-sm font-medium text-gray-500">Overall Progress</p><div class="w-full progress-bar-bg rounded-full h-2.5 mt-3"><div id="student-progress-bar" class="progress-bar h-2.5 rounded-full" style="width: 0%"></div></div><p id="student-progress-text" class="text-right text-sm font-semibold text-gray-700 mt-1"></p></div>
                        <div class="bg-white p-6 rounded-lg shadow-md"><p class="text-sm font-medium text-gray-500">Average Score</p><p id="student-avg-score" class="text-3xl font-bold text-gray-800"></p></div>
                        <div class="bg-white p-6 rounded-lg shadow-md"><p class="text-sm font-medium text-gray-500">Tutors Used</p><p id="student-tutors-used" class="text-3xl font-bold text-gray-800"></p></div>
                        <div class="bg-white p-6 rounded-lg shadow-md"><p class="text-sm font-medium text-gray-500">Total Time Spent</p><p id="student-time-spent" class="text-3xl font-bold text-gray-800"></p></div>
                    </div>

                    <!-- Key Skill Performance Section -->
                    <div id="skill-performance-section" class="bg-white p-6 rounded-lg shadow-md hidden">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">Key Skill Performance</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                            <div>
                                <h3 class="font-semibold text-gray-700 mb-2 text-center">Skill Profile</h3>
                                <div class="h-80"><canvas id="skillRadarChart"></canvas></div>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-700 mb-2">Skill Details</h3>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-left">
                                        <thead>
                                            <tr class="bg-gray-50 text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                                <th class="p-3">Skill</th>
                                                <th class="p-3 text-center">Proficiency</th>
                                            </tr>
                                        </thead>
                                        <tbody id="student-skill-table-body" class="text-sm divide-y divide-gray-200"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-md"><h2 class="text-xl font-bold text-gray-800 mb-4">Engagement & Effort per Module</h2><div class="h-80"><canvas id="studentEngagementChart"></canvas></div></div>
                    <div class="bg-white p-6 rounded-lg shadow-md"><h2 class="text-xl font-bold text-gray-800 mb-4">Module Breakdown</h2><div class="overflow-x-auto"><table class="w-full text-left"><thead><tr class="bg-gray-50 text-xs font-semibold text-gray-600 uppercase tracking-wider"><th class="p-3">Module / Tutor</th><th class="p-3 text-center">Status</th><th class="p-3 text-center">Score</th><th class="p-3 text-center">Attempts</th><th class="p-3">Time Spent</th></tr></thead><tbody id="student-module-table-body" class="text-sm divide-y divide-gray-200"></tbody></table></div></div>
                </div>
            </div>

            <div class="mt-8 pt-6 border-t border-gray-200">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">Tutor Analytics</h2>
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">

                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold text-gray-800 mb-2">Tutor Performance Comparison</h2>
                        <p class="text-sm text-gray-600 mb-4">Compares learner scores and time spent across different
                            tutors.</p>
                        <div class="h-96">
                            <canvas id="tutorPerformanceChart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold text-gray-800 mb-2">Tutor Engagement Funnel</h2>
                        <p class="text-sm text-gray-600 mb-4">Shows learner drop-off from assignment to completion.</p>
                        <div class="h-96">
                            <canvas id="tutorEngagementChart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-md xl:col-span-2">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <h2 class="text-xl font-bold text-gray-800 mb-2">Tutor Content Overview</h2>
                                <p class="text-sm text-gray-600 mb-4">Provides a high-level view of the tutor
                                    library.</p>
                                <h3 class="font-semibold text-gray-700 mb-2 text-sm">Distribution by Subject</h3>
                                <div class="h-48">
                                    <canvas id="tutorSubjectChart"></canvas>
                                </div>
                            </div>
                            <div>
                                <h2 class="text-xl font-bold text-gray-800 mb-2">Tutor Status</h2>
                                <p class="text-sm text-gray-600 mb-4">Tracks which tutors are published or in draft.</p>
                                <div class="overflow-y-auto max-h-60 border rounded-lg">
                                    <table class="w-full text-left text-sm">
                                        <thead class="sticky top-0">
                                        <tr class="bg-gray-50 text-xs font-semibold text-gray-600 uppercase">
                                            <th class="p-2">Tutor Name</th>
                                            <th class="p-2 text-center">Status</th>
                                            <th class="p-2">Last Updated</th>
                                        </tr>
                                        </thead>
                                        <tbody id="tutor-status-table" class="divide-y divide-gray-200">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>


    <script>
        // --- ORIGINAL DATA SIMULATION ---
        const studentsData = [
            {
                id: 1, name: 'Emily Carter', progress: 100, avgScore: 92, timeSpent: '8h 15m',
                modules: [
                    {name: 'Python Basics', status: 'Completed', score: 95, attempts: 1, time: '45m'},
                    {name: 'Data Types Tutor', status: 'Completed', score: 98, attempts: 1, time: '30m'},
                    {name: 'Control Flow', status: 'Completed', score: 88, attempts: 2, time: '1h 10m'},
                    {name: 'Functions', status: 'Completed', score: 90, attempts: 1, time: '1h'},
                    {name: 'Solving Equations Tutor', status: 'Completed', score: 85, attempts: 2, time: '55m'},
                ],
                skills: {'Variable Scope': 95, 'List Manipulation': 90, 'Algorithmic Logic': 88}
            },
            {
                id: 2, name: 'Benjamin Lee', progress: 80, avgScore: 85, timeSpent: '7h 30m',
                modules: [
                    {name: 'Python Basics', status: 'Completed', score: 90, attempts: 1, time: '50m'},
                    {name: 'Data Types Tutor', status: 'Completed', score: 88, attempts: 2, time: '40m'},
                    {name: 'Control Flow', status: 'Completed', score: 82, attempts: 2, time: '1h 20m'},
                    {name: 'Functions', status: 'In Progress', score: null, attempts: 1, time: '45m'},
                ],
                skills: {'Variable Scope': 85, 'List Manipulation': 88, 'Algorithmic Logic': 75}
            },
            {
                id: 3, name: 'Olivia Chen', progress: 60, avgScore: 78, timeSpent: '9h 5m',
                modules: [
                    {name: 'Python Basics', status: 'Completed', score: 85, attempts: 2, time: '1h 15m'},
                    {name: 'Data Types Tutor', status: 'Completed', score: 68, attempts: 3, time: '1h 5m'},
                    {name: 'Control Flow', status: 'Struggling', score: 55, attempts: 4, time: '2h'},
                ],
                skills: {'Variable Scope': 80, 'List Manipulation': 55, 'Algorithmic Logic': 60}
            },
            {
                id: 4, name: 'Daniel Garcia', progress: 20, avgScore: 75, timeSpent: '2h 10m',
                modules: [
                    {name: 'Python Basics', status: 'Completed', score: 75, attempts: 3, time: '1h 30m'},
                ],
                skills: {'Variable Scope': 75}
            },
        ];

        const courseData = {
            activeLearners: {current: 98, previous: 85},
            avgScore: {current: 84, previous: 81},
            completionRate: {current: 75, previous: 72},
            avgSession: {current: '12m 45s'},
            mostActiveCourse: 'Introduction to Python',
            mostUsedTutor: 'Solving Linear Equations',
            dailyActivity: {
                labels: Array.from({length: 15}, (_, i) => `Day ${i + 1}`),
                data: [12, 19, 15, 25, 22, 30, 28, 35, 32, 40, 45, 41, 50, 48, 55]
            },
            topLearners: {
                labels: ['Emily Carter', 'Benjamin Lee', 'Olivia Chen', 'Daniel Garcia', 'Sophia Rodriguez'],
                data: [5, 4, 3, 1, 1]
            },
            completionFunnel: {
                labels: ['Start Course', 'Module 1', 'Module 2', 'Module 3', 'Finish Course'],
                data: [120, 105, 95, 88, 80]
            },
            contentHotspots: {labels: ['Control Flow', 'Data Types Tutor', 'Python Basics'], data: [11, 7, 5]}
        };

        // --- DUMMY DATA FOR TUTOR ANALYTICS ---
        const tutorPerformanceData = {
            labels: ['Solving Linear Equations', 'Python List Comprehensions', 'Recursive Functions', 'HTML Structure Basics', 'CSS Flexbox Tutor'],
            avgScores: [88, 92, 75, 85, 81],
            avgDurations: [25, 15, 35, 12, 28]
        };
        const tutorEngagementData = {
            labels: ['Solving Linear Equations', 'Python List Comprehensions', 'Recursive Functions', 'HTML Structure Basics'],
            assigned: [98, 98, 85, 85],
            accessed: [85, 90, 60, 78],
            completed: [75, 82, 45, 75]
        };
        const tutorContentData = {
            subjects: {
                labels: ['Algebra', 'Python Basics', 'Data Structures', 'Web Development'],
                data: [5, 8, 3, 6]
            },
            status: [
                {name: 'Solving Linear Equations', status: 'Published', updated: '2025-08-15'},
                {name: 'Python List Comprehensions', status: 'Published', updated: '2025-07-22'},
                {name: 'Recursive Functions', status: 'Published', updated: '2025-06-30'},
                {name: 'HTML Structure Basics', status: 'Published', updated: '2025-08-01'},
                {name: 'Intro to CSS', status: 'Draft', updated: '2025-08-28'},
                {name: 'Advanced Calculus', status: 'Draft', updated: '2025-09-01'},
            ]
        };

        let studentEngagementChartInstance, skillRadarChartInstance;

        // --- HELPER FUNCTIONS ---
        function parseTimeToMinutes(timeStr) {
            let totalMinutes = 0;
            const hoursMatch = timeStr.match(/(\d+)\s*h/);
            const minutesMatch = timeStr.match(/(\d+)\s*m/);
            if (hoursMatch) totalMinutes += parseInt(hoursMatch[1]) * 60;
            if (minutesMatch) totalMinutes += parseInt(minutesMatch[1]);
            return totalMinutes;
        }

        // --- UI LOGIC ---
        function showTab(tabName) {
            document.getElementById('dashboard-overview').classList.add('hidden');
            document.getElementById('student-drilldown').classList.add('hidden');
            document.getElementById('tab-overview-btn').classList.remove('active');
            document.getElementById('tab-drilldown-btn').classList.remove('active');
            if (tabName === 'overview') {
                document.getElementById('dashboard-overview').classList.remove('hidden');
                document.getElementById('tab-overview-btn').classList.add('active');
            } else {
                document.getElementById('student-drilldown').classList.remove('hidden');
                document.getElementById('tab-drilldown-btn').classList.add('active');
            }
        }

        function showStudentDetails(studentId) {
            const student = studentsData.find(s => s.id === studentId);
            if (!student) return;
            document.getElementById('drilldown-placeholder').classList.add('hidden');
            document.getElementById('drilldown-content').classList.remove('hidden');
            document.getElementById('student-name-header').textContent = student.name;
            document.getElementById('student-avg-score').textContent = `${student.avgScore}%`;
            document.getElementById('student-tutors-used').textContent = student.modules.filter(m => m.name.includes('Tutor')).length;
            document.getElementById('student-time-spent').textContent = student.timeSpent;
            const progressBar = document.getElementById('student-progress-bar');
            progressBar.style.width = `${student.progress}%`;
            document.getElementById('student-progress-text').textContent = `${student.progress}% Complete`;
            const skillSection = document.getElementById('skill-performance-section');
            if (student.skills && Object.keys(student.skills).length > 0) {
                skillSection.classList.remove('hidden');
                const skillTableBody = document.getElementById('student-skill-table-body');
                skillTableBody.innerHTML = '';
                Object.entries(student.skills).forEach(([skill, score]) => {
                    let scoreClass = 'bg-yellow-100 text-yellow-800';
                    if (score >= 90) scoreClass = 'bg-green-100 text-green-800'; else if (score < 70) scoreClass = 'bg-red-100 text-red-800';
                    skillTableBody.innerHTML += `<tr><td class="p-3 font-medium text-gray-800">${skill}</td><td class="p-3 text-center"><span class="py-1 px-2 rounded-full text-xs font-medium ${scoreClass}">${score}%</span></td></tr>`;
                });
                if (skillRadarChartInstance) skillRadarChartInstance.destroy();
                skillRadarChartInstance = new Chart(document.getElementById('skillRadarChart'), {
                    type: 'radar',
                    data: {
                        labels: Object.keys(student.skills),
                        datasets: [{
                            label: 'Proficiency',
                            data: Object.values(student.skills),
                            fill: true,
                            backgroundColor: 'rgba(79, 70, 229, 0.2)',
                            borderColor: 'rgb(79, 70, 229)',
                            pointBackgroundColor: 'rgb(79, 70, 229)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgb(79, 70, 229)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        elements: {line: {tension: 0.1}},
                        scales: {r: {angleLines: {display: false}, suggestedMin: 0, suggestedMax: 100}},
                        plugins: {legend: {display: false}}
                    }
                });
            } else {
                skillSection.classList.add('hidden');
            }
            if (studentEngagementChartInstance) studentEngagementChartInstance.destroy();
            studentEngagementChartInstance = new Chart(document.getElementById('studentEngagementChart'), {
                data: {
                    labels: student.modules.map(m => m.name),
                    datasets: [{
                        type: 'bar',
                        label: 'Attempts',
                        data: student.modules.map(m => m.attempts),
                        backgroundColor: 'rgba(239, 68, 68, 0.6)',
                        yAxisID: 'y'
                    }, {
                        type: 'line',
                        label: 'Time Spent (min)',
                        data: student.modules.map(m => parseTimeToMinutes(m.time)),
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        tension: 0.2,
                        fill: true,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {mode: 'index', intersect: false},
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {display: true, text: 'Number of Attempts'}
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {display: true, text: 'Time Spent (min)'},
                            grid: {drawOnChartArea: false}
                        }
                    }
                }
            });
            const moduleTableBody = document.getElementById('student-module-table-body');
            moduleTableBody.innerHTML = '';
            student.modules.forEach(m => {
                let scoreClass = '';
                if (m.score >= 90) scoreClass = 'bg-green-100 text-green-800 font-semibold'; else if (m.score < 70 && m.score != null) scoreClass = 'bg-red-100 text-red-800 font-semibold';
                let attemptsIcon = m.attempts > 2 ? `<i class="fas fa-exclamation-triangle text-yellow-500 ml-2" title="${m.attempts} attempts taken"></i>` : '';
                moduleTableBody.innerHTML += `<tr class="hover:bg-gray-50"><td class="p-3 font-medium text-gray-800">${m.name}</td><td class="p-3 text-center">${m.status}</td><td class="p-3 text-center ${scoreClass}">${m.score !== null ? m.score + '%' : 'N/A'}</td><td class="p-3 text-center">${m.attempts}${attemptsIcon}</td><td class="p-3">${m.time}</td></tr>`;
            });
            showTab('drilldown');
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            // --- ORIGINAL CHART RENDERING AND DATA POPULATION ---
            document.getElementById('og-kpi-active-learners').textContent = courseData.activeLearners.current;
            document.getElementById('og-kpi-avg-session').textContent = courseData.avgSession.current;
            document.getElementById('og-kpi-most-course').textContent = courseData.mostActiveCourse;
            document.getElementById('og-kpi-most-tutor').textContent = courseData.mostUsedTutor;
            const insightsContainer = document.getElementById('dynamic-insights');
            const learnerChange = courseData.activeLearners.current - courseData.activeLearners.previous;
            const scoreChange = courseData.avgScore.current - courseData.avgScore.previous;
            insightsContainer.innerHTML = `<p><i class="fas fa-arrow-up text-green-500 fa-fw mr-2"></i>You had <strong class="text-indigo-600">${courseData.activeLearners.current}</strong> active learners, an increase of <strong class="text-green-600">${learnerChange}</strong>.</p><p><i class="fas fa-check-circle text-green-500 fa-fw mr-2"></i>The average score is <strong class="text-indigo-600">${courseData.avgScore.current}%</strong>, up by <strong class="text-green-600">${scoreChange} points</strong>.</p><p><i class="fas fa-fire text-red-500 fa-fw mr-2"></i><strong class="text-red-600">Control Flow</strong> appears to be the most challenging topic.</p>`;
            const learnerTableBody = document.getElementById('learner-table-body');
            studentsData.forEach(student => {
                learnerTableBody.innerHTML += `<tr class="hover:bg-gray-50"><td class="p-3 font-medium text-gray-800">${student.name}</td><td class="p-3"><div class="w-full progress-bar-bg rounded-full h-2.5"><div class="progress-bar h-2.5 rounded-full" style="width: ${student.progress}%"></div></div></td><td class="p-3 font-semibold">${student.avgScore}%</td><td class="p-3">${student.timeSpent}</td><td class="p-3 text-center"><button onclick="showStudentDetails(${student.id})" class="text-indigo-600 hover:text-indigo-800 font-semibold">View Details &rarr;</button></td></tr>`;
            });
            new Chart(document.getElementById('learnerActivityChart'), {
                type: 'line',
                data: {
                    labels: courseData.dailyActivity.labels,
                    datasets: [{
                        label: 'Active Learners',
                        data: courseData.dailyActivity.data,
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.2)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {y: {beginAtZero: true}},
                    plugins: {legend: {display: false}}
                }
            });
            new Chart(document.getElementById('topLearnersChart'), {
                type: 'bar',
                data: {
                    labels: courseData.topLearners.labels,
                    datasets: [{
                        label: 'Modules Completed',
                        data: courseData.topLearners.data,
                        backgroundColor: '#4f46e5'
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {x: {beginAtZero: true}},
                    plugins: {legend: {display: false}}
                }
            });

            // --- RENDER TUTOR ANALYTICS VISUALIZATIONS ---

            // 1. Tutor Performance Comparison
            new Chart(document.getElementById('tutorPerformanceChart'), {
                type: 'bar',
                data: {
                    labels: tutorPerformanceData.labels,
                    datasets: [{
                        label: 'Average Score (%)',
                        data: tutorPerformanceData.avgScores,
                        backgroundColor: 'rgba(79, 70, 229, 0.8)',
                    }, {
                        label: 'Avg. Session Duration (min)',
                        data: tutorPerformanceData.avgDurations,
                        backgroundColor: 'rgba(5, 150, 105, 0.7)',
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {stacked: false, beginAtZero: true},
                        y: {stacked: false}
                    },
                    plugins: {
                        tooltip: {mode: 'index', intersect: false}
                    }
                }
            });

            // 2. Tutor Engagement Funnel
            new Chart(document.getElementById('tutorEngagementChart'), {
                type: 'bar',
                data: {
                    labels: tutorEngagementData.labels,
                    datasets: [{
                        label: 'Assigned',
                        data: tutorEngagementData.assigned,
                        backgroundColor: 'rgba(79, 70, 229, 0.4)',
                    }, {
                        label: 'Accessed',
                        data: tutorEngagementData.accessed,
                        backgroundColor: 'rgba(79, 70, 229, 0.7)',
                    }, {
                        label: 'Completed',
                        data: tutorEngagementData.completed,
                        backgroundColor: 'rgba(79, 70, 229, 1.0)',
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {x: {beginAtZero: true}, y: {beginAtZero: true}},
                    plugins: {tooltip: {mode: 'index'}}
                }
            });

            // 3. Tutor Content: Donut Chart
            new Chart(document.getElementById('tutorSubjectChart'), {
                type: 'doughnut',
                data: {
                    labels: tutorContentData.subjects.labels,
                    datasets: [{
                        label: 'Count',
                        data: tutorContentData.subjects.data,
                        backgroundColor: ['#4f46e5', '#10b981', '#f59e0b', '#3b82f6'],
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {legend: {position: 'right', labels: {boxWidth: 12}}}
                }
            });

            // 3. Tutor Content: Status Table
            const tableBody = document.getElementById('tutor-status-table');
            tableBody.innerHTML = '';
            tutorContentData.status.forEach(tutor => {
                const statusClass = tutor.status === 'Published' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800';
                const row = `<tr class="hover:bg-gray-50"><td class="p-2 font-medium text-gray-800">${tutor.name}</td><td class="p-2 text-center"><span class="py-1 px-2 rounded-full text-xs font-semibold ${statusClass}">${tutor.status}</span></td><td class="p-2 text-gray-600">${tutor.updated}</td></tr>`;
                tableBody.innerHTML += row;
            });
        });
    </script>
</body>
</html>