{% extends "base.html" %}

{% block title %}Tutor View{% endblock %}

{% block head_extra %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/learner/main-content/tutor-view.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

        <link rel="stylesheet" href="{{ url_for('static', filename='css/instructor/main-content/builder/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/instructor/main-content/builder/canvas.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/instructor/main-content/builder/chatbox.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/instructor/right-sidebars/builder/component-sidebar/component-sidebar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/instructor/right-sidebars/builder/component-sidebar/components/choice-elements.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/instructor/right-sidebars/builder/component-sidebar/components/interactive-tasks.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/instructor/right-sidebars/builder/component-sidebar/components/layout-media.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/instructor/right-sidebars/builder/component-sidebar/components/math-elements.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/instructor/right-sidebars/builder/component-sidebar/components/shapes.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/instructor/right-sidebars/builder/component-sidebar/components/text-and-input.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/instructor/right-sidebars/builder/expert-model-sidebar.css') }}">
{% endblock %}

{% block sidebar %}
    {{ sidebarHtml | safe }}
{% endblock %}

{% block content %}
<div id="learner-tutor-main-flex-container" class="flex gap-8 w-full items-start">

    <div id="learner-tutor-tutor-container" class="flex-grow learner-tutor-hidden">

        <div class="mb-6 flex justify-center">
            <div id="tutor-nav-buttons" class="inline-flex rounded-md shadow-sm" role="group">
                {% if tutor_titles %}
                    {% for title in tutor_titles %}
                        <button
                            type="button"
                            class="tutor-nav-btn px-4 py-2 text-sm font-medium border border-gray-300 bg-white text-gray-700 hover:bg-gray-100
                                   {% if loop.first %}rounded-l-lg{% else %}border-l-0{% endif %}
                                   {% if loop.last %}rounded-r-lg{% endif %}"
                            data-title="{{ title|e }}"
                        >
                            {{ title }}
                        </button>
                    {% endfor %}
                {% endif %}
            </div>
        </div>

        <div id="tutor-content-area">
            </div>

    </div>

    <aside id="learner-tutor-analytics-container" class="w-96 flex-shrink-0 bg-white p-6 rounded-xl shadow-lg flex flex-col">
        <h2 id="analytics-title" class="text-2xl font-bold text-gray-800 mb-6 border-b pb-4">Session Activity</h2>
        <div class="flex-grow">
            <div id="overall-progress-container" class="mb-6"><div class="flex justify-between items-center mb-1"><h3 class="font-bold text-gray-700">Overall Progress</h3><span id="progress-text" class="text-sm font-medium text-indigo-600">--/--</span></div><div class="w-full learner-tutor-progress-bar-bg rounded-full h-2.5"><div id="progress-bar" class="learner-tutor-progress-bar h-2.5 rounded-full" style="width: 0%"></div></div></div>
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-gray-50 p-4 rounded-lg"><p class="text-sm font-medium text-gray-500">Problems Done</p><p id="kpi-completed" class="text-3xl font-bold text-gray-800">--</p></div>
                <div class="bg-gray-50 p-4 rounded-lg"><p class="text-sm font-medium text-gray-500">Correctness</p><p id="kpi-score" class="text-3xl font-bold text-green-600">--</p></div>
                <div class="bg-gray-50 p-4 rounded-lg"><p class="text-sm font-medium text-gray-500">Hints Used</p><p id="kpi-hints" class="text-3xl font-bold text-gray-800">--</p></div>
                <div class="bg-gray-50 p-4 rounded-lg"><p class="text-sm font-medium text-gray-500">Time</p><p id="kpi-time" class="text-3xl font-bold text-gray-800">--</p></div>
            </div>
            <div><h3 class="text-lg font-bold text-gray-700 mb-3">Step-by-Step Performance</h3><div id="step-performance-list" class="space-y-4"><p class="text-gray-500 text-sm">Waiting for tutor to start...</p></div></div>
        </div>
        <div class="mt-6">
            <button id="end-session-btn" class="w-full bg-red-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-red-700 transition" disabled>End Session</button>
        </div>
    </aside>
</div>

<div id="confirmation-modal" class="learner-tutor-modal-overlay learner-tutor-hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60">
    <div class="learner-tutor-modal-content bg-white w-full max-w-md p-6 rounded-xl shadow-2xl">
        <h3 class="text-2xl font-bold text-gray-800">End Session?</h3>
        <p class="text-gray-600 mt-2 mb-6">Are you sure you want to end your current learning session?</p>
        <div class="flex justify-end gap-4">
            <button id="modal-btn-no" class="px-6 py-2 rounded-lg bg-gray-200 text-gray-800 hover:bg-gray-300 font-semibold">No, Continue</button>
            <button id="modal-btn-yes" class="px-6 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 font-semibold">Yes, End Session</button>
        </div>
    </div>
</div>
{% endblock %}

{% block right_sidebar %}
    {# This view does not use a right sidebar #}
{% endblock %}

{% block scripts_extra %}
    <script id="tutor-html" type="application/json">{{ tutorHtml|tojson }}</script>

    <script id="tutor-titles" type="application/json">{{ tutor_titles|tojson }}</script>

    <script>
        window.userId = "{{ user_id|default('anonymous') }}";
        window.isPreview = "{{ preview|default(false)|string|lower }}" === 'true';
    </script>

    <script src="{{ url_for('static', filename='javascript/learner/main-content/tutor-view.js') }}"></script>
{% endblock %}