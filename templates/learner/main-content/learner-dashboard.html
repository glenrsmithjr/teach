<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learner Dashboard - Apprentice Tutors</title>
    <!-- Tailwind CSS -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js for Graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        body { background-color: #f3f4f6; }
        .sidebar-transition { transition: width 0.3s ease-in-out; }
        .sidebar-expanded { width: 280px; }
        .sidebar-collapsed { width: 88px; }
        .main-content { transition: margin-left 0.3s ease-in-out; }
        .content-with-sidebar-expanded { margin-left: 280px; }
        .content-with-sidebar-collapsed { margin-left: 88px; }

        .sidebar-collapsed .nav-text,
        .sidebar-collapsed .section-header {
            opacity: 0;
            visibility: hidden;
            width: 0;
            transition: opacity 0.1s;
        }

        #sidebarToggle svg { transition: transform 0.3s ease-in-out; }
        .sidebar-collapsed #sidebarToggle svg { transform: rotate(180deg); }

        .chat-modal {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        .chat-modal.hidden {
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
        }
        .progress-bar-bg { background-color: #e5e7eb; }
        .progress-bar { background-color: #4f46e5; transition: width 0.5s ease-in-out; }
    </style>
</head>
<body class="bg-gray-100">
    <div class="flex min-h-screen">
        <!-- Learner Sidebar (unchanged) -->
        <aside id="sidebar" class="fixed top-0 left-0 z-40 h-screen sidebar-transition bg-gray-900 text-gray-100 shadow-xl flex flex-col overflow-hidden sidebar-expanded">
            <div class="flex items-center justify-between p-5 border-b border-gray-800">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-lg bg-indigo-500 flex items-center justify-center text-white text-2xl font-bold">A</div>
                    <div class="font-bold text-xl whitespace-nowrap nav-text">Apprentice Tutors</div>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto py-5 px-3">
                <h3 class="uppercase text-xs tracking-wider text-gray-400 px-4 mb-2 section-header">Navigation</h3>
                <a href="#dashboard" class="flex items-center p-3 rounded-lg mb-2 cursor-pointer transition-all bg-indigo-500">
                    <div class="min-w-6 h-6 mr-4 flex items-center justify-center"><i class="fas fa-home fa-fw"></i></div>
                    <div class="whitespace-nowrap nav-text">Dashboard</div>
                </a>
                <a href="#courses" class="flex items-center p-3 rounded-lg mb-2 cursor-pointer transition-all hover:bg-gray-800">
                    <div class="min-w-6 h-6 mr-4 flex items-center justify-center"><i class="fas fa-book fa-fw"></i></div>
                    <div class="whitespace-nowrap nav-text">My Courses</div>
                </a>
                 <a href="#tutors" class="flex items-center p-3 rounded-lg mb-2 cursor-pointer transition-all hover:bg-gray-800">
                    <div class="min-w-6 h-6 mr-4 flex items-center justify-center"><i class="fas fa-robot fa-fw"></i></div>
                    <div class="whitespace-nowrap nav-text">My Tutors</div>
                </a>
                <h3 class="uppercase text-xs tracking-wider text-gray-400 px-4 mb-2 mt-6 section-header">Account</h3>
                <a href="#profile" class="flex items-center p-3 rounded-lg mb-2 cursor-pointer transition-all hover:bg-gray-800">
                    <div class="min-w-6 h-6 mr-4 flex items-center justify-center"><i class="fas fa-user-circle fa-fw"></i></div>
                    <div class="whitespace-nowrap nav-text">Profile</div>
                </a>
            </div>
            <div id="sidebarToggle" class="absolute right-[-16px] bottom-5 w-8 h-8 bg-indigo-500 text-white rounded-full flex items-center justify-center cursor-pointer border-2 border-white shadow-md z-50" onclick="toggleSidebar()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
            </div>
        </aside>

        <!-- Main Content -->
        <main id="content-container" class="main-content content-with-sidebar-expanded w-full p-8">
            <div class="space-y-8">
                <!-- Header -->
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">Welcome, Emily!</h1>
                    <p class="mt-1 text-gray-600">Here's your learning progress. Keep up the great work!</p>
                </div>

                <!-- Key Progress Indicators -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-md"><p class="text-sm font-medium text-gray-500">Courses Enrolled</p><p id="kpi-courses" class="text-3xl font-bold text-gray-800">--</p></div>
                    <div class="bg-white p-6 rounded-lg shadow-md"><p class="text-sm font-medium text-gray-500">Tutors Completed</p><p id="kpi-tutors" class="text-3xl font-bold text-gray-800">--</p></div>
                    <div class="bg-white p-6 rounded-lg shadow-md"><p class="text-sm font-medium text-gray-500">Average Score</p><p id="kpi-score" class="text-3xl font-bold text-gray-800">--</p></div>
                    <div class="bg-white p-6 rounded-lg shadow-md"><p class="text-sm font-medium text-gray-500">Total Time Spent</p><p id="kpi-time" class="text-3xl font-bold text-gray-800">--</p></div>
                </div>

                <!-- NEW: Key Insights Section -->
                <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-indigo-500">
                    <h2 class="text-xl font-bold text-gray-800 mb-2">Your Weekly Summary</h2>
                    <div id="dynamic-insights" class="text-gray-700 space-y-2">
                        <!-- JS Populates This -->
                        <p>Loading insights...</p>
                    </div>
                </div>

                <!-- NEW: Visualizations Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">Time Spent (Last 7 Days)</h2>
                        <div class="h-80"><canvas id="timeSpentChart"></canvas></div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">Your Skill Profile</h2>
                        <div class="h-80"><canvas id="skillProfileChart"></canvas></div>
                    </div>
                </div>


                <!-- My Courses & Tutors Section -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div id="courses" class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">My Courses</h2>
                        <div id="courses-list" class="space-y-6">
                            <p class="text-gray-500">Loading your courses...</p>
                        </div>
                    </div>
                    <div id="tutors" class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">Continue Learning</h2>
                        <div id="recent-tutors-list" class="space-y-4">
                            <p class="text-gray-500">Loading recent tutors...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Instructor Chat Floating Button & Modal (unchanged) -->
    <button onclick="toggleChat()" class="fixed bottom-8 right-8 bg-indigo-600 text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center hover:bg-indigo-700 transition-transform transform hover:scale-110 z-50">
        <i class="fas fa-comment-dots fa-2x"></i>
    </button>
    <div id="chat-modal" class="chat-modal hidden fixed bottom-28 right-8 w-full max-w-sm bg-white rounded-xl shadow-2xl z-40">
        <div class="flex items-center justify-between p-4 bg-indigo-600 text-white rounded-t-xl">
            <h3 class="font-bold text-lg">Contact Your Instructor</h3><button onclick="toggleChat(false)" class="text-indigo-200 hover:text-white">&times;</button>
        </div>
        <div id="chat-messages" class="p-4 h-64 overflow-y-auto space-y-4">
             <div class="flex items-start gap-2.5"><div class="flex flex-col w-full max-w-[320px] leading-1.5 p-3 border-gray-200 bg-gray-100 rounded-e-xl rounded-es-xl"><p class="text-sm font-normal text-gray-900">Hi! I have a quick question about the 'Control Flow' module. Can you help?</p></div></div>
        </div>
        <div class="p-4 border-t border-gray-200">
            <div class="flex items-center gap-2">
                <input type="text" id="chat-input" placeholder="Type your message..." class="flex-grow bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5">
                <button onclick="sendMessage()" class="bg-indigo-600 text-white p-2.5 rounded-lg hover:bg-indigo-700"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>


    <script>
        // --- UPDATED DUMMY LEARNER DATA ---
        const learnerData = {
            metrics: { coursesEnrolled: 2, tutorsCompleted: 4, avgScore: '89%', timeSpent: '15h 45m' },
            insights: {
                timeThisWeek: '4h 20m',
                strongestSkill: 'Python Basics',
                strongestSkillScore: 95,
                trickyTopic: 'Control Flow'
            },
            skills: { 'Python Basics': 95, 'Control Flow': 78, 'Algebra': 88, 'Web Concepts': 91, 'Functions': 82 },
            weeklyTimeSpent: { // In minutes
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                data: [30, 45, 20, 60, 55, 15, 75]
            },
            courses: [
                {
                    id: 1, name: 'Introduction to Python', instructor: 'Dr. Alan Grant', progress: 80,
                    modules: [
                        { name: 'Python Basics', status: 'Completed', tutors: [ { name: 'Variables Tutor', status: 'Completed' }, { name: 'Data Types Tutor', status: 'Completed' } ] },
                        { name: 'Control Flow', status: 'In Progress', tutors: [ { name: 'If/Else Tutor', status: 'Completed' }, { name: 'Loops Tutor', status: 'In Progress' } ] },
                        { name: 'Functions', status: 'Not Started', tutors: [ { name: 'Defining Functions Tutor', status: 'Not Started' } ] }
                    ]
                },
                {
                    id: 2, name: 'Advanced Algebra', instructor: 'Dr. Ellie Sattler', progress: 100,
                    modules: [ { name: 'Polynomials', status: 'Completed', tutors: [ { name: 'Solving Equations Tutor', status: 'Completed' } ] }]
                }
            ],
            recentTutors: [
                { name: 'Loops Tutor', course: 'Introduction to Python' },
                { name: 'Solving Equations Tutor', course: 'Advanced Algebra' },
            ]
        };

        // --- UI INTERACTIVITY (unchanged) ---
        function toggleSidebar() { /* ... */ const sidebar = document.getElementById('sidebar'); const content = document.getElementById('content-container'); sidebar.classList.toggle('sidebar-expanded'); sidebar.classList.toggle('sidebar-collapsed'); content.classList.toggle('content-with-sidebar-expanded'); content.classList.toggle('content-with-sidebar-collapsed'); }
        function toggleChat(forceOpen = null) { /* ... */ const chatModal = document.getElementById('chat-modal'); if (forceOpen === true) { chatModal.classList.remove('hidden'); } else if (forceOpen === false) { chatModal.classList.add('hidden'); } else { chatModal.classList.toggle('hidden'); } }
        function sendMessage() { /* ... */ const input = document.getElementById('chat-input'); const messagesContainer = document.getElementById('chat-messages'); if (input.value.trim() === '') return; const messageHtml = `<div class="flex items-start gap-2.5 justify-end"><div class="flex flex-col w-full max-w-[320px] leading-1.5 p-3 border-gray-200 bg-indigo-500 text-white rounded-s-xl rounded-ee-xl"><p class="text-sm font-normal">${input.value}</p></div></div>`; messagesContainer.innerHTML += messageHtml; input.value = ''; messagesContainer.scrollTop = messagesContainer.scrollHeight; }
        function toggleCourseDetails(courseId) { /* ... */ const details = document.getElementById(`course-details-${courseId}`); const icon = document.getElementById(`course-toggle-icon-${courseId}`); details.classList.toggle('hidden'); icon.classList.toggle('fa-chevron-down'); icon.classList.toggle('fa-chevron-up');}

        // --- DATA POPULATION ---
        function populateKPIsAndLists() {
            document.getElementById('kpi-courses').textContent = learnerData.metrics.coursesEnrolled;
            document.getElementById('kpi-tutors').textContent = learnerData.metrics.tutorsCompleted;
            document.getElementById('kpi-score').textContent = learnerData.metrics.avgScore;
            document.getElementById('kpi-time').textContent = learnerData.metrics.timeSpent;

            const coursesList = document.getElementById('courses-list');
            coursesList.innerHTML = '';
            learnerData.courses.forEach(course => {
                const modulesHtml = course.modules.map(module => `<div class="p-4 bg-gray-50 rounded-lg"><h4 class="font-semibold text-gray-800">${module.name} <span class="text-xs font-medium ml-2 ${module.status === 'Completed' ? 'text-green-600' : 'text-yellow-600'}">${module.status}</span></h4><div class="mt-3 space-y-2">${module.tutors.map(tutor => `<div class="flex items-center justify-between text-sm"><span class="text-gray-600"><i class="fas fa-robot text-gray-400 mr-2"></i>${tutor.name}</span><span class="py-0.5 px-2 rounded-full text-xs ${tutor.status === 'Completed' ? 'bg-green-100 text-green-800' : 'bg-gray-200 text-gray-700'}">${tutor.status}</span></div>`).join('')}</div></div>`).join('');
                coursesList.innerHTML += `<div class="border border-gray-200 rounded-lg"><div class="flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50" onclick="toggleCourseDetails(${course.id})"><div><h3 class="font-bold text-lg text-indigo-700">${course.name}</h3><p class="text-sm text-gray-500">Instructor: ${course.instructor}</p></div><div class="flex items-center gap-4"><div class="w-32 text-right"><p class="text-xs text-gray-500 mb-1">${course.progress}% Complete</p><div class="w-full progress-bar-bg rounded-full h-2"><div class="progress-bar h-2 rounded-full" style="width: ${course.progress}%"></div></div></div><i id="course-toggle-icon-${course.id}" class="fas fa-chevron-down text-gray-500"></i></div></div><div id="course-details-${course.id}" class="hidden p-4 border-t border-gray-200 space-y-4">${modulesHtml}</div></div>`;
            });
            
            const recentTutorsList = document.getElementById('recent-tutors-list');
            recentTutorsList.innerHTML = '';
            learnerData.recentTutors.forEach(tutor => {
                recentTutorsList.innerHTML += `<div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"><div><p class="font-semibold text-gray-700">${tutor.name}</p><p class="text-sm text-gray-500">${tutor.course}</p></div><button class="bg-indigo-100 text-indigo-700 font-bold py-1 px-3 rounded-lg hover:bg-indigo-200 text-sm">Launch</button></div>`;
            });
        }
        
        // --- NEW: POPULATE INSIGHTS & CHARTS ---
        function populateInsights() {
            const insightsContainer = document.getElementById('dynamic-insights');
            const i = learnerData.insights;
            insightsContainer.innerHTML = `
                <p><i class="fas fa-clock text-blue-500 fa-fw mr-2"></i>You've dedicated <strong class="text-indigo-600">${i.timeThisWeek}</strong> to learning this week. Keep up the momentum!</p>
                <p><i class="fas fa-star text-yellow-500 fa-fw mr-2"></i>Your strongest skill is <strong class="text-indigo-600">${i.strongestSkill}</strong> with a proficiency of <strong class="text-green-600">${i.strongestSkillScore}%</strong>.</p>
                <p><i class="fas fa-lightbulb text-red-500 fa-fw mr-2"></i>The <strong class="text-red-600">${i.trickyTopic}</strong> topic seems challenging. Consider reviewing its tutors.</p>
            `;
        }

        function initializeCharts() {
            // Time Spent Bar Chart
            new Chart(document.getElementById('timeSpentChart'), {
                type: 'bar',
                data: {
                    labels: learnerData.weeklyTimeSpent.labels,
                    datasets: [{
                        label: 'Minutes Spent',
                        data: learnerData.weeklyTimeSpent.data,
                        backgroundColor: 'rgba(79, 70, 229, 0.8)',
                        borderColor: 'rgba(79, 70, 229, 1)',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true, title: { display: true, text: 'Minutes' } } },
                    plugins: { legend: { display: false } }
                }
            });

            // Skill Profile Radar Chart
            new Chart(document.getElementById('skillProfileChart'), {
                type: 'radar',
                data: {
                    labels: Object.keys(learnerData.skills),
                    datasets: [{
                        label: 'Proficiency',
                        data: Object.values(learnerData.skills),
                        fill: true,
                        backgroundColor: 'rgba(79, 70, 229, 0.2)',
                        borderColor: 'rgb(79, 70, 229)',
                        pointBackgroundColor: 'rgb(79, 70, 229)',
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { r: { angleLines: { display: false }, suggestedMin: 50, suggestedMax: 100, pointLabels: { font: { size: 13 } } } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            populateKPIsAndLists();
            populateInsights();
            initializeCharts();
        });
    </script>
</body>
</html>